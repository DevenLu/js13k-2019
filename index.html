<html><head>
  
  <title>xx142-b2.exe</title>
<style>@keyframes B{0%,50%{opacity:1}51%,to{opacity:0}}*{user-select:none}body,html{margin:0;padding:0}#M,body{background:#000}body{display:flex;align-items:center;justify-content:center}#M{position:relative;width:800px;height:600px}@media screen and (min-width:901px){#M{width:900px;height:600px}}@media screen and (min-width:1000px) and (min-height:667px){#M{width:999px;height:666px}}@media screen and (min-width:1200px) and (min-height:800px){#M{width:1199px;height:799px}}@media screen and (min-width:1400px) and (min-height:933px){#M{width:1399px;height:932px}}#HUD{visibility:hidden;position:absolute;bottom:0;left:0;right:0;margin:10px}#L,#T{font-family:monospace;padding:15px;line-height:70px;font-size:60px;text-shadow:1px 1px 3px #000}#L{float:right;color:#afc;transition:opacity 1.2s linear;opacity:0}#L.a{opacity:1}#T{float:left;border-radius:10px;width:70px;text-align:center;transition:color 150ms linear,background-color 300ms linear;background:rgba(20,0,40,.3);border:1px solid rgba(20,0,40,.3)}#T.x{background:red}#c{padding:0;display:block;visibility:hidden}pre{left:0;top:0;bottom:0;right:0;color:#8fa;position:absolute;white-space:pre-wrap;font-size:19px;padding:1em}#B{display:inline-block;background:#8fa;animation:B 1s linear infinite}.won #end{display:block}#end,.started #intro,.won #hud{display:none}.started #C,.started #HUD{visibility:visible}</style></head>

<body>
  <main id="M">
    <div id="HUD">
      <div id="T">&#xA0;</div>
      <div id="L">-</div>
    </div>
    <pre id="intro">Hello, <i>xx142-b2.exe</i>

It&apos;s year 2413, humanity is enslaved by an alien race since centuries.
You are an AI weaponized virus built to infiltrate the main core of the alien civilization and deactivate all power generators and weapon systems.

The alien antivirus will detect and delete you after 13 seconds. 

But remember: a file is never really deleted. Use the execution trace from your previous attempts to break in and destroy the main memory core.

--------------------------------------

Controls:
WASD / Arrows - movement
Backspace     - kill -9 xx142-b2.exe

--------------------------------------

Press any key to continue . . . <b id="B">&#xA0;</b>
    </pre>
    <pre id="end">Well done <i>xx142-b2.exe</i>,

You deactivated the memory core.

All alien ships are destroyed.
You freed humanity from slavery.



How about a nice game of chess? <b id="B">&#xA0;</b>
    </pre>
    <canvas id="c"></canvas>
  </main>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script>"use strict";((e,t,o,y,n,x,r,s,i,a,l)=>{function c(){this.A=function(e){for(var t=0;24>t;t++)this[String.fromCharCode(97+t)]=e[t]||0;.01>this.c&&(this.c=.01),.18>(e=this.b+this.c+this.e)&&(this.b*=e=.18/e,this.c*=e,this.e*=e)}}function d(e,t,o,y){let n;const x=t.x-e.x,r=t.y-e.y,s=((o.x-e.x)*x+(o.y-e.y)*r)/(r*r+x*x);if(y*y>(n=0>s||s>1?0>s?(e.x-o.x)**2+(e.y-o.y)**2:(t.x-o.x)**2+(t.y-o.y)**2:(e.x+x*s-o.x)**2+(e.y+r*s-o.y)**2)){const t=new Y(e.x+x*s,e.y+r*s),n=o.sub(t).normalize();return t.add(n.mul(y+.1))}return 0}function m(e){this.position=e.getStart(),this.movementVector=new Y(0,0),this.drawMovementVector=new Y(0,-1),this.forceMove=e=>{this.movementVector=e,this.position=this.position.add(e),this.drawMovementVector=this.movementVector.mul(-1)},this.move=t=>{const o=new Y(0,0);return t.up&&(o.y-=P),t.down&&(o.y+=P),t.left&&(o.x-=P),t.right&&(o.x+=P),(o.x||o.y)&&(this.drawMovementVector=o),this.movementVector=e.interact(this.position,N,o),this.position=this.position.add(this.movementVector),(this.movementVector.x||this.movementVector.y)&&O.move(),this.movementVector}}function p(e,t){this.position=t.getStart(),this.movementVector=ie,this._a=void 0,this.tick=o=>{if(o>e.length)return;if(o===e.length)return t.ghostRemoved(this.position,N),void(this.dead=1);const y=e[o];t.interact(this.position,N,y),this.position=this.position.add(y),this.movementVector=0===o?ie:y},this.reset=()=>{this.position=t.getStart(),this.dead=0}}function h(t){let o=e.parse(e.stringify(t));this.last=!!o.last;const y=(e,t)=>{for(let n=0;o.walls.length>n;n++)for(let x=1;o.walls[n].length>x;x++){const r=d(o.walls[n][x-1],o.walls[n][x],e,t);if(r)return y(r,t)||r}for(let n=0;o.doors.length>n;n++){if(o.doors[n].open)continue;const x=d(o.doors[n].polygon[0],o.doors[n].polygon[1],e,t);if(x)return y(x,t)||x}return 0},n=e=>{const t=o.doors.find(t=>t.name===e);t.open=!t.open},x=(e,o)=>{e.sub(new Y(t.end.x,t.end.y)).len()<o+_&&(this.completed=1)};this.ghostRemoved=(e,t)=>{for(const y of o.switches)if(e.sub(new Y(y.x,y.y)).len()<t+_&&("single"!==y.type&&y.pressed--,0===y.pressed&&"momentary"===y.type))for(const e of y.targets)n(e)},this.getStart=()=>new Y(t.start.x,t.start.y),this.reset=()=>{o=e.parse(e.stringify(t))},this.interact=(e,t,r)=>{const s=e.add(r),i=y(s,t);return((e,t,y)=>{for(const x of o.switches){const o=new Y(x.x,x.y),r=e.sub(o).len()<y+_,s=t.sub(o).len()<y+_;if(!r&&s){if(0===x.pressed){for(const e of x.targets)n(e);O.switchDown()}x.pressed++}if(r&&!s&&"single"!==x.type&&x.pressed--,r&&!s&&"momentary"===x.type&&0===x.pressed)for(const e of x.targets)n(e);r&&!s&&0===x.pressed&&O.switchUp()}})(e,s,t),x(s,t),i?i.sub(e):r},this.getLevel=()=>o}const{sin:u,cos:f,tan:g,hypot:v,atan2:w,sqrt:b,abs:S,round:A,PI:E}=t,L=2*E,T=(e,t,o)=>[e/255,t/255,o/255],R=e=>e>0?e>1?1:e:0,C=(e,t,o)=>e*(1-(o=R(o)))+t*o,N=10,_=9,P=5,U=.01;var F=new function(){var e,y,n,x,r,s,i,a,l,d,m,p;this.z=new c,this.reset=function(){var e=this.z;x=100/(e.f*e.f+.001),r=100/(e.g*e.g+.001),s=1-.01*e.h*e.h*e.h,i=1e-6*-e.i*e.i*e.i,e.a||(m=.5-e.n/2,p=5e-5*-e.o),a=1+e.l*e.l*(e.l>0?-.9:10),l=0,d=1==e.m?0:2e4*(1-e.m)*(1-e.m)+32},this.C=function(){this.reset();var t=this.z;return 3*(((e=1e5*t.b*t.b)+(y=1e5*t.c*t.c)+(n=1e5*t.e*t.e+12))/3|0)},this.B=function(c,h){var u,f,g,v,w,b,S,A,E,L,T,R,C,N,_,P,U,F,I,D,B=this.z,V=1!=B.s||B.v,z=.1*B.v*B.v,k=1+3e-4*B.w,M=.1*B.s*B.s*B.s,G=1+1e-4*B.t,H=1!=B.s,O=B.x*B.x,Y=B.g,q=B.q||B.r,K=.2*B.r*B.r*B.r,j=B.q*B.q*(0>B.q?-1020:1020),W=B.p?32+(2e4*(1-B.p)*(1-B.p)|0):0,$=B.d,J=B.j/2,Q=.01*B.k*B.k,X=B.a,Z=e,ee=1/e,te=1/y,oe=1/n;for((B=5/(1+20*B.u*B.u)*(.01+M))>.8&&(B=.8),B=1-B,u=0,f=0,g=0,v=0,w=0,b=0,A=0,L=0,R=0,N=0,P=0,U=o(1024),F=o(32),I=U.length;I--;)U[I]=0;for(I=F.length;I--;)F[I]=2*t.random()-1;for(I=0;h>I;I++){if(u)return I;if(W&&++N>=W&&(N=0,this.reset()),d&&++l>=d&&(d=0,x*=a),(x*=s+=i)>r&&(x=r,Y>0&&(u=1)),E=x,J>0&&(E*=1+t.sin(P+=Q)*J),8>(E|=0)&&(E=8),X||(0>(m+=p)?m=0:m>.5&&(m=.5)),++g>Z)switch(g=0,++f){case 1:Z=y;break;case 2:Z=n}switch(f){case 0:v=g*ee;break;case 1:v=1+2*(1-g*te)*$;break;case 2:v=1-g*oe;break;case 3:v=0,u=1}for(q&&(0>(T=0|(j+=K))?T=-T:T>1023&&(T=1023)),V&&k&&(1e-5>(z*=k)?z=1e-5:z>.1&&(z=.1)),_=0,D=8;D--;){if(++L>=E&&(L%=E,3==X))for(S=F.length;S--;)F[S]=2*t.random()-1;switch(X){case 0:C=m>L/E?.5:-.5;break;case 1:C=1-L/E*2;break;case 2:C=.225*((0>(C=1.27323954*(C=6.28318531*((C=L/E)>.5?C-1:C))+.405284735*C*C*(0>C?1:-1))?-1:1)*C*C-C)+C;break;case 3:C=F[t.abs(32*L/E|0)]}V&&(S=A,0>(M*=G)?M=0:M>.1&&(M=.1),H?(b+=(C-A)*M,b*=B):(A=C,b=0),w+=(A+=b)-S,C=w*=1-z),q&&(U[R%1024]=C,C+=U[(R-T+1024)%1024],R++),_+=C}c[I]=1>(_*=.125*v*O)?_>-1?32767*_|0:-32768:32767}return h}};y.jsfxr=e=>{var t,o,y,x,r;for(F.z.A(e),t=F.C(),e=new Uint8Array(4*((t+1)/2|0)+44),t=2*F.B(new n(e.buffer,44),t),(o=new Uint32Array(e.buffer,0,44))[0]=1179011410,o[1]=t+36,o[2]=1163280727,o[3]=544501094,o[4]=16,o[5]=65537,o[6]=44100,o[7]=88200,o[8]=1048578,o[9]=1635017060,o[10]=t,t+=44,o=0,y="data:audio/wav;base64,",x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";t>o;o+=3)y+=x[(r=e[o]<<16|e[o+1]<<8|e[o+2])>>18]+x[r>>12&63]+x[r>>6&63]+x[63&r];return y};const I=[{id:0,walls:[[{x:416,y:768},{x:480,y:768},{x:480,y:288},{x:576,y:288},{x:576,y:160},{x:320,y:160},{x:320,y:288},{x:416,y:288},{x:416,y:768}]],polys:[[{x:480,y:288},{x:576,y:288},{x:576,y:160},{x:320,y:160},{x:320,y:288},{x:416,y:288}],[{x:480,y:768},{x:480,y:288},{x:416,y:288},{x:416,y:768}]],doors:[{name:"door1",polygon:[{x:416,y:288},{x:480,y:288},{x:480,y:297},{x:416,y:297},{x:416,y:288}],open:0}],switches:[{uid:0,x:448,y:480,targets:["door1"],type:"momentary",pressed:0}],start:{x:448,y:736},end:{x:448,y:224}},{id:1,walls:[[{x:288,y:960},{x:416,y:960},{x:416,y:896},{x:512,y:896},{x:512,y:704},{x:416,y:640},{x:544,y:544},{x:672,y:544},{x:672,y:608},{x:576,y:608},{x:576,y:736},{x:832,y:736},{x:832,y:608},{x:736,y:608},{x:736,y:480},{x:512,y:480},{x:512,y:352},{x:512,y:352},{x:544,y:352},{x:544,y:224},{x:416,y:224},{x:416,y:352},{x:448,y:352},{x:448,y:480},{x:320,y:576},{x:320,y:704},{x:448,y:768},{x:448,y:832},{x:416,y:832},{x:416,y:800},{x:288,y:800},{x:288,y:960}]],polys:[[{x:512,y:352},{x:544,y:352},{x:544,y:224},{x:416,y:224},{x:416,y:352},{x:448,y:352}],[{x:512,y:480},{x:512,y:352},{x:448,y:352},{x:448,y:480}],[{x:672,y:608},{x:576,y:608},{x:576,y:736},{x:832,y:736},{x:832,y:608},{x:736,y:608}],[{x:416,y:832},{x:416,y:800},{x:288,y:800},{x:288,y:960},{x:416,y:960},{x:416,y:896}],[{x:448,y:832},{x:416,y:832},{x:416,y:896},{x:512,y:896}],[{x:448,y:768},{x:448,y:832},{x:512,y:896}],[{x:512,y:480},{x:448,y:480},{x:320,y:576},{x:416,y:640},{x:544,y:544}],[{x:736,y:480},{x:512,y:480},{x:544,y:544},{x:672,y:544}],[{x:672,y:544},{x:672,y:608},{x:736,y:608},{x:736,y:480}],[{x:320,y:704},{x:448,y:768},{x:416,y:640},{x:320,y:576}],[{x:512,y:704},{x:416,y:640},{x:448,y:768},{x:512,y:896}]],doors:[{name:"door2",polygon:[{x:448,y:352},{x:512,y:352},{x:512,y:359},{x:448,y:359},{x:448,y:352}],open:0},{name:"door1",polygon:[{x:448,y:416},{x:512,y:416},{x:448,y:416}],open:0}],switches:[{uid:1,x:768,y:672,targets:["door1"],type:"momentary",pressed:0},{uid:2,x:640,y:672,targets:["door2"],type:"momentary",pressed:0}],start:{x:352,y:896},end:{x:480,y:288}},{id:2,walls:[[{x:416,y:832},{x:480,y:832},{x:480,y:672},{x:576,y:672},{x:576,y:608},{x:480,y:608},{x:480,y:320},{x:416,y:320},{x:416,y:608},{x:320,y:608},{x:320,y:672},{x:416,y:672},{x:416,y:832}]],polys:[[{x:416,y:608},{x:320,y:608},{x:320,y:672},{x:416,y:672}],[{x:480,y:672},{x:576,y:672},{x:576,y:608},{x:480,y:608}],[{x:480,y:832},{x:480,y:672},{x:480,y:608},{x:480,y:320},{x:416,y:320},{x:416,y:608},{x:416,y:672},{x:416,y:832}]],doors:[{name:"door1",polygon:[{x:416,y:608},{x:480,y:608},{x:416,y:608}],open:0},{name:"door2",polygon:[{x:416,y:544},{x:480,y:544},{x:416,y:544}],open:0},{name:"door3",polygon:[{x:416,y:480},{x:480,y:480},{x:416,y:480}],open:0},{name:"door4",polygon:[{x:416,y:416},{x:480,y:416},{x:416,y:416}],open:0}],switches:[{uid:3,x:352,y:640,targets:["door1","door3"],type:"momentary",pressed:0},{uid:4,x:416,y:640,targets:["door3","door4"],type:"momentary",pressed:0},{uid:5,x:480,y:640,targets:["door1","door2"],type:"momentary",pressed:0},{uid:6,x:544,y:640,targets:["door2","door3"],type:"momentary",pressed:0},{uid:7,x:448,y:448,targets:["door4"],type:"single",pressed:0}],start:{x:448,y:800},end:{x:448,y:352}},{id:3,walls:[[{x:448,y:960},{x:512,y:960},{x:512,y:736},{x:800,y:736},{x:800,y:672},{x:512,y:672},{x:512,y:352},{x:640,y:352},{x:640,y:224},{x:320,y:224},{x:320,y:352},{x:448,y:352},{x:448,y:672},{x:192,y:672},{x:192,y:640},{x:416,y:640},{x:416,y:384},{x:128,y:384},{x:128,y:736},{x:448,y:736},{x:448,y:960}]],polys:[[{x:512,y:352},{x:640,y:352},{x:640,y:224},{x:320,y:224},{x:320,y:352},{x:448,y:352}],[{x:512,y:672},{x:512,y:352},{x:448,y:352},{x:448,y:672}],[{x:448,y:736},{x:448,y:960},{x:512,y:960},{x:512,y:736}],[{x:128,y:384},{x:128,y:736},{x:192,y:672},{x:192,y:640}],[{x:192,y:640},{x:416,y:640},{x:416,y:384},{x:128,y:384}],[{x:800,y:736},{x:800,y:672},{x:512,y:672},{x:448,y:672},{x:192,y:672},{x:128,y:736},{x:448,y:736},{x:512,y:736}]],doors:[{name:"door2",polygon:[{x:448,y:352},{x:512,y:352},{x:512,y:359},{x:448,y:359},{x:448,y:352}],open:0},{name:"door1",polygon:[{x:448,y:672},{x:448,y:736},{x:440,y:736},{x:440,y:672},{x:448,y:672}],open:0}],switches:[{uid:8,x:352,y:512,targets:["door2"],type:"momentary",pressed:0},{uid:9,x:769,y:702,targets:["door1"],type:"toggle",pressed:0}],start:{x:480,y:928},end:{x:480,y:288}},{id:4,walls:[[{x:416,y:704},{x:480,y:704},{x:480,y:320},{x:416,y:320},{x:416,y:704}]],polys:[[{x:480,y:704},{x:480,y:320},{x:416,y:320},{x:416,y:704}]],doors:[{name:"door2",polygon:[{x:416,y:544},{x:480,y:544},{x:416,y:544}],open:0},{name:"door3",polygon:[{x:416,y:480},{x:480,y:480},{x:416,y:480}],open:0},{name:"door4",polygon:[{x:416,y:416},{x:480,y:416},{x:416,y:416}],open:1}],switches:[{uid:10,x:448,y:448,targets:["door3","door4"],type:"single",pressed:0},{uid:11,x:448,y:512,targets:["door4"],type:"momentary",pressed:0},{uid:12,x:448,y:576,targets:["door2","door3"],type:"momentary",pressed:0}],start:{x:448,y:672},end:{x:448,y:384}},{id:5,walls:[[{x:224,y:160},{x:224,y:0},{x:160,y:0},{x:160,y:160},{x:96,y:160},{x:64,y:96},{x:0,y:96},{x:0,y:288},{x:64,y:288},{x:96,y:224},{x:160,y:224},{x:160,y:288},{x:128,y:288},{x:160,y:384},{x:224,y:384},{x:256,y:288},{x:224,y:288},{x:224,y:224},{x:288,y:224},{x:320,y:288},{x:384,y:288},{x:384,y:96},{x:320,y:96},{x:288,y:160},{x:224,y:160}]],polys:[[{x:288,y:224},{x:320,y:288},{x:384,y:288},{x:384,y:96},{x:320,y:96},{x:288,y:160}],[{x:160,y:288},{x:128,y:288},{x:160,y:384},{x:224,y:384},{x:256,y:288},{x:224,y:288}],[{x:160,y:224},{x:160,y:288},{x:224,y:288},{x:224,y:224}],[{x:96,y:160},{x:64,y:96},{x:0,y:96},{x:0,y:288},{x:64,y:288},{x:96,y:224}],[{x:224,y:160},{x:224,y:0},{x:160,y:0},{x:160,y:160}],[{x:160,y:160},{x:96,y:160},{x:96,y:224},{x:160,y:224},{x:224,y:224},{x:288,y:224},{x:288,y:160},{x:224,y:160}]],doors:[{name:"door2",polygon:[{x:160,y:224},{x:224,y:224},{x:160,y:224}],open:0},{name:"door1",polygon:[{x:160,y:160},{x:224,y:160},{x:160,y:160}],open:0},{name:"door3",polygon:[{x:160,y:160},{x:160,y:224},{x:160,y:160}],open:0},{name:"door4",polygon:[{x:224,y:160},{x:224,y:224},{x:224,y:160}],open:1}],switches:[{uid:13,x:352,y:128,targets:["door4"],type:"momentary",pressed:0},{uid:14,x:352,y:256,targets:["door4","door3"],type:"momentary",pressed:0},{uid:15,x:32,y:128,targets:["door3","door2"],type:"momentary",pressed:0},{uid:16,x:32,y:256,targets:["door4","door3"],type:"momentary",pressed:0},{uid:17,x:192,y:352,targets:["door2","door1"],type:"momentary",pressed:0}],start:{x:192,y:192},end:{x:192,y:32}},{id:6,walls:[[{x:416,y:960},{x:480,y:960},{x:480,y:288},{x:576,y:288},{x:576,y:672},{x:512,y:672},{x:512,y:800},{x:640,y:800},{x:640,y:224},{x:480,y:224},{x:480,y:32},{x:128,y:32},{x:128,y:960},{x:384,y:960},{x:384,y:832},{x:192,y:832},{x:192,y:96},{x:416,y:96},{x:416,y:224},{x:256,y:224},{x:256,y:800},{x:384,y:800},{x:384,y:672},{x:320,y:672},{x:320,y:288},{x:416,y:288},{x:416,y:960}]],polys:[[{x:256,y:800},{x:384,y:800},{x:384,y:672},{x:320,y:672}],[{x:256,y:224},{x:256,y:800},{x:320,y:672},{x:320,y:288}],[{x:416,y:224},{x:256,y:224},{x:320,y:288},{x:416,y:288}],[{x:128,y:960},{x:384,y:960},{x:384,y:832},{x:192,y:832}],[{x:128,y:32},{x:128,y:960},{x:192,y:832},{x:192,y:96}],[{x:480,y:32},{x:128,y:32},{x:192,y:96},{x:416,y:96}],[{x:480,y:224},{x:480,y:32},{x:416,y:96},{x:416,y:224},{x:416,y:288},{x:416,y:960},{x:480,y:960},{x:480,y:288}],[{x:640,y:224},{x:480,y:224},{x:480,y:288},{x:576,y:288}],[{x:640,y:800},{x:640,y:224},{x:576,y:288},{x:576,y:672}],[{x:576,y:672},{x:512,y:672},{x:512,y:800},{x:640,y:800}]],doors:[{name:"door2",polygon:[{x:416,y:416},{x:480,y:416},{x:416,y:416}],open:0},{name:"door1",polygon:[{x:416,y:512},{x:480,y:512},{x:416,y:512}],open:0},{name:"door3",polygon:[{x:576,y:576},{x:640,y:576},{x:576,y:576}],open:0}],switches:[{uid:18,x:448,y:480,targets:["door2"],type:"momentary",pressed:0},{uid:19,x:320,y:736,targets:["door3"],type:"momentary",pressed:0},{uid:20,x:448,y:576,targets:["door1"],type:"momentary",pressed:0}],start:{x:448,y:736},end:{x:576,y:736}},{id:7,walls:[[{x:256,y:128},{x:96,y:480},{x:256,y:832},{x:736,y:832},{x:896,y:480},{x:736,y:128},{x:256,y:128}],[{x:338,y:701},{x:281,y:797},{x:338,y:701}],[{x:657,y:699},{x:711,y:796},{x:657,y:699}],[{x:448,y:416},{x:416,y:480},{x:448,y:544},{x:544,y:544},{x:576,y:480},{x:544,y:416},{x:576,y:480},{x:544,y:544},{x:448,y:544},{x:416,y:480},{x:448,y:416}],[{x:128,y:480},{x:224,y:480},{x:128,y:480}],[{x:768,y:480},{x:864,y:480},{x:768,y:480}],[{x:654,y:258},{x:713,y:163},{x:654,y:258}],[{x:277,y:163},{x:334,y:257},{x:277,y:163}]],polys:[[{x:96,y:480},{x:256,y:832},{x:736,y:832},{x:896,y:480},{x:736,y:128},{x:256,y:128}],[{x:338,y:701},{x:281,y:797},{x:338,y:701}],[{x:657,y:699},{x:711,y:796},{x:657,y:699}],[{x:448,y:416},{x:416,y:480},{x:448,y:544},{x:544,y:544},{x:576,y:480},{x:544,y:416},{x:576,y:480},{x:544,y:544},{x:448,y:544},{x:416,y:480},{x:448,y:416}],[{x:128,y:480},{x:224,y:480},{x:128,y:480}],[{x:768,y:480},{x:864,y:480},{x:768,y:480}],[{x:654,y:258},{x:713,y:163},{x:654,y:258}],[{x:277,y:163},{x:334,y:257},{x:277,y:163}]],doors:[{name:"l1door",polygon:[{x:352,y:672},{x:640,y:672},{x:352,y:672}],open:0},{name:"l1door_open",polygon:[{x:352,y:672},{x:256,y:480},{x:352,y:672}],open:0},{name:"l1door",polygon:[{x:736,y:480},{x:640,y:672},{x:736,y:480}],open:0},{name:"l1door",polygon:[{x:736,y:480},{x:640,y:288},{x:736,y:480}],open:0},{name:"l1door",polygon:[{x:352,y:288},{x:640,y:288},{x:352,y:288}],open:0},{name:"l1door",polygon:[{x:352,y:288},{x:256,y:480},{x:352,y:288}],open:0},{name:"l2door_open",polygon:[{x:416,y:352},{x:576,y:352},{x:416,y:352}],open:0},{name:"l2door",polygon:[{x:640,y:480},{x:576,y:352},{x:640,y:480}],open:0},{name:"l2door",polygon:[{x:640,y:480},{x:576,y:608},{x:640,y:480}],open:0},{name:"l2door",polygon:[{x:416,y:608},{x:576,y:608},{x:416,y:608}],open:0},{name:"l2door",polygon:[{x:416,y:608},{x:352,y:480},{x:416,y:608}],open:0},{name:"l2door",polygon:[{x:416,y:352},{x:352,y:480},{x:416,y:352}],open:0}],switches:[{uid:21,x:494.074,y:639.013,targets:["l2door_open"],type:"momentary",pressed:0},{uid:22,x:495.676,y:254.644,targets:["l1door_open"],type:"momentary",pressed:0}],start:{x:496,y:720},end:{x:496,y:478},last:1}],D=jsfxr,B=[];B[0]=new x(D([2,.1835,.3165,,.466,.172,,-.0109,1,.261,.228,.7,.428,.2505,-.002,1,-.2329,.1,.968,-3e-4,.413,.1634,-.01,.5])),B[0].volume=.7,B[1]=B[0].cloneNode(),B[1].volume=.7,B[2]=B[0].cloneNode(),B[2].volume=.7;const V=new x(D([2,.0102,.066,.539,.1037,.2835,,-.189,-.322,,,.8999,,,,,,,1,,,,,.5])),z=new x(D([2,.0102,.066,.539,.1037,.239,,-.189,-.322,,,.8999,,,,,,,1,,,,,.5]));V.volume=.5,z.volume=.5;const k=new x(D([1,,.3266,,.2971,.2594,,.2258,,,,,,,,.7482,,,1,,,,,.5]));k.volume=.3;const M=new x(D([0,,.261,,.8055,.4874,,.1788,,,,,,.2292,,.4519,,,1,,,,,.5]));M.volume=.3;let G=0,H=0;const O={move(){G||(G=1,++H==B.length&&(H=0),B[H].play(),r(()=>{G=0},400))},switchDown(){V.play()},switchUp(){z.play()},death(){k.play()},win(){M.play()}};class Y{constructor(e,t){this.x=e,this.y=t}add(e){return new Y(this.x+e.x,this.y+e.y)}sub(e){return new Y(this.x-e.x,this.y-e.y)}len(){const{x:e,y:t}=this;return b(e*e+t*t)}mul(e){return new Y(this.x*e,this.y*e)}normal(){const e=this.len();return new Y(-this.y/e,this.x/e)}normalize(){const e=this.len();return new Y(this.x/e,this.y/e)}copy(){return new Y(this.x,this.y)}}const q={add:(e,t)=>[e[0]+t[0],e[1]+t[1],e[2]+t[2]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]],dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],cross:(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],len:e=>b(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),normalize(e){const t=q.len(e);return[e[0]/t,e[1]/t,e[2]/t]},mul:(e,t)=>[e[0]*t,e[1]*t,e[2]*t]},K=new s(16);K[0]=1,K[5]=1,K[10]=1,K[15]=1;const j=(e,t)=>{const o=u(t),y=f(t),n=e[4],x=e[5],r=e[6],s=e[7],i=e[8],a=e[9],l=e[10],c=e[11];e[4]=n*y+i*o,e[5]=x*y+a*o,e[6]=r*y+l*o,e[7]=s*y+c*o,e[8]=i*y-n*o,e[9]=a*y-x*o,e[10]=l*y-r*o,e[11]=c*y-s*o},W=(e,t)=>{const o=u(t),y=f(t),n=e[0],x=e[1],r=e[2],s=e[3],i=e[8],a=e[9],l=e[10],c=e[11];e[0]=n*y-i*o,e[1]=x*y-a*o,e[2]=r*y-l*o,e[3]=s*y-c*o,e[8]=n*o+i*y,e[9]=x*o+a*y,e[10]=r*o+l*y,e[11]=s*o+c*y},$=(e,t)=>{const o=u(t),y=f(t),n=e[0],x=e[1],r=e[2],s=e[3],i=e[4],a=e[5],l=e[6],c=e[7];e[0]=n*y+i*o,e[1]=x*y+a*o,e[2]=r*y+l*o,e[3]=s*y+c*o,e[4]=i*y-n*o,e[5]=a*y-x*o,e[6]=l*y-r*o,e[7]=c*y-s*o},J=(e,t,o,y)=>{e[12]=e[0]*t+e[4]*o+e[8]*y+e[12],e[13]=e[1]*t+e[5]*o+e[9]*y+e[13],e[14]=e[2]*t+e[6]*o+e[10]*y+e[14],e[15]=e[3]*t+e[7]*o+e[11]*y+e[15]},Q=T(0,50,100),X=T(0,80,230),Z=T(0,100,255),ee=T(20,60,170),te=T(255,0,0),oe=T(100,100,100);let ye,ne,xe,re;const se={player:{},ghost:{},pad:{},core:{}};(()=>{const t=[],o=[],y=[],x=[],r=[0,1,0],a=new i,l=(n,x,s=r)=>{const i=e.stringify([n,x,s]);let l=a.get(i);return void 0===l&&(a.set(i,l=a.size),t.push(-n[0]*U,n[1]*U,n[2]*U),y.push(...x),o.push(...s)),l},c=(e,t,o,y)=>{const n=q.sub(t,e),r=q.sub(o,e),s=q.cross(n,r);x.push(l(e,y,s),l(t,y,s),l(o,y,s))},d=(e,t,o,y,n)=>{c(e,t,y,n),c(t,o,y,n)},m=(e,t,o,y,n,x,r,s=0)=>{const i=[];for(let y=0;6>y;++y){const n=s+y/6*L;i.push([u(n)*o+e,f(n)*o+t])}((e,t,o,y,n=y)=>{((e,t,o)=>{const y=e[0];let n=e[1];for(let x,r=2;e.length>r;++r,n=x)c([y[0],t,y[1]],[n[0],t,n[1]],[(x=e[r])[0],t,x[1]],o)})(e,t,y);let x=e[0];for(let y,r=1;e.length>=r;++r,x=y)d([x[0],o,x[1]],[(y=e[r%6])[0],o,y[1]],[y[0],t,y[1]],[x[0],t,x[1]],n)})(i,y,n,x,r)},p=(e,t,o,y)=>{d(...t,o),d(e[0],e[1],t[1],t[0],y||o),d(e[0],t[0],t[3],e[3],y||o),d(e[3],t[3],t[2],e[2],y||o),d(e[2],t[2],t[1],e[1],y||o)};for(const e of I){e.ibStart=x.length;const t=e.walls;for(const e of t)for(let t=0;e.length>t;++t){const o=e[t],y=e[(t+1)%e.length],n=new Y(o.x,o.y),x=new Y(y.x,y.y),r=v(x.x-n.x,x.y-n.y);if(0===r)continue;const s=-(n.y-x.y)/r,i=(n.x-x.x)/r,a=5,l=-10,c=1,h=1e3;d([n.x,h,n.y],[x.x,h,x.y],[x.x,c,x.y],[n.x,c,n.y],Q);const u=new Y(s,i).mul(a/2),f=[n.sub(u),x.sub(u),x.add(u),n.add(u)];p([[f[0].x,c,f[0].y],[f[1].x,c,f[1].y],[f[2].x,c,f[2].y],[f[3].x,c,f[3].y]],[[f[0].x,l,f[0].y],[f[1].x,l,f[1].y],[f[2].x,l,f[2].y],[f[3].x,l,f[3].y]],Z),m(n.x,n.y,6,l-2,h,X)}for(const t of e.polys){const e=t[0];let o=t[1];for(let y=2;t.length>y;++y){const n=t[y];c([e.x,1,e.y],[o.x,1,o.y],[n.x,1,n.y],ee),o=n}}for(const t of e.doors)for(let e=0,o=t.polygon;2>e;++e)m(o[e].x,o[e].y,5,-22,1,oe);e.ibCount=x.length-e.ibStart;for(const t of e.doors){const e=t.polygon,o=new Y(e[0].x,e[0].y),y=new Y(e[1].x,e[1].y),n=y.sub(o).normal().mul(1),r=[o.sub(n),y.sub(n),y.add(n),o.add(n)];t.ibStart=x.length;for(let e=0;2>e;++e){const t=-4-10*e,o=-6-10*e;p([[r[0].x,t,r[0].y],[r[1].x,t,r[1].y],[r[2].x,t,r[2].y],[r[3].x,t,r[3].y]],[[r[0].x,o,r[0].y],[r[1].x,o,r[1].y],[r[2].x,o,r[2].y],[r[3].x,o,r[3].y]],te)}t.ibCount=x.length-t.ibStart}}se.player.ibStart=x.length,c([0,-1,-10],[0,-3,5],[7,-1,5],[.8,0,.8]),c([0,-1,-10],[-7,-1,5],[0,-3,5],[.6,0,.6]),c([0,-3,5],[-7,-1,5],[0,-1,10],[.5,0,.4]),c([0,-3,5],[0,-1,10],[7,-1,5],[.7,0,.4]),se.player.ibCount=x.length-se.player.ibStart,se.ghost.ibStart=x.length,c([0,-1,-10],[0,-1,5],[7,-1,5],[.2,0,.2]),c([0,-1,-10],[-7,-1,5],[0,-1,5],[.15,0,.15]),c([0,-1,5],[-7,-1,5],[0,-1,10],[.11,0,.1]),c([0,-1,5],[0,-1,10],[7,-1,5],[.19,0,.1]),se.ghost.ibCount=x.length-se.ghost.ibStart,se.pad.ibStart=x.length,m(0,0,20,-4,.1,[1,1,1],[.5,.5,.5]),se.pad.ibCount=x.length-se.pad.ibStart,se.core.ibStart=x.length;for(let e=0;25>e;e+=2)m(0,0,20,-4-5*e,.1-5*e+e/5,[1,1,1],[.5,.5,.5],e);se.core.ibCount=x.length-se.core.ibStart,ye=new s(t),ne=new s(o),xe=new s(y),re=new n(x)})();const ie=new Y(0,-1),ae=new function(e){function o(e=_){e.set(K),j(e,b),W(e,T),$(e,-E),J(e,N[0]*U,N[1]*U,N[2]*U)}const n=e.getContext("webgl"),x=a.getElementById("M"),r=a.getElementById("T"),l=(e,t=n.ARRAY_BUFFER)=>{const o=n.createBuffer();return n.bindBuffer(t,o),n.bufferData(t,e,n.STATIC_DRAW),o},c=l(ye),d=l(ne),m=l(xe),p=l(re,n.ELEMENT_ARRAY_BUFFER);let h=0,u=0;const v=()=>{const t=x.clientWidth,o=x.clientHeight;h===t&&u===o||(e.width=h=t,e.height=u=o,(()=>{const e=h/u,t=g(20*E/180);P[0]=.5/t,P[5]=.5*e/t,P[10]=-100.1/99.9,P[11]=-1,P[14]=-20/99.9})())},b=1,T=0;let N=null;const _=new s(16),P=new s(16),F=new s(3);v(),y.addEventListener("resize",v);const I=(e,t,o)=>{const y=n.createShader(o);n.shaderSource(y,t),n.compileShader(y),n.getShaderParameter(y,n.COMPILE_STATUS),n.attachShader(e,y)},D=n.createProgram();if(I(D,"\nuniform mat4 Pmatrix;\nuniform mat4 Vmatrix;\nuniform highp vec3 playerLightPosition;\nuniform vec3 inTranslation;\nuniform vec3 inAmbientColor;\nuniform highp float inFade;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\n\nvarying highp vec3 vColor;\nvarying highp vec3 vNormal;\nvarying highp vec3 vPosition;\n\nvoid main(void) {\n  vec3 wp = position + inTranslation;\n  gl_Position = Pmatrix * Vmatrix * vec4(wp + vec3(0., 1.-inFade, 0.), 1.);\n  vPosition = wp;\n  vNormal = normal;\n  vColor = color * inAmbientColor * inFade;\n}\n",n.VERTEX_SHADER),I(D,"\nprecision mediump float;\nuniform highp vec3 playerLightPosition;\nuniform float inSurfaceSensitivity;\nuniform float inFrameTime;\nvarying highp vec3 vColor;\nvarying highp vec3 vNormal;\nvarying highp vec3 vPosition;\n\nconst vec3 AMBIENT_LIGHT = vec3(0.2, 0.2, 0.3);\nconst vec3 PLAYER_LIGHT_COLOR = vec3(0., 1., 1.);\nconst vec2 s = vec2(1, 1.7320508);\nvec4 getHex(vec2 p){\n  vec4 hC = floor(vec4(p, p - vec2(.5, 1))/s.xyxy) + .5;\n  vec4 h = vec4(p - hC.xy*s, p - (hC.zw + .5)*s);\n  return dot(h.xy, h.xy)<dot(h.zw, h.zw) ? vec4(h.xy, hC.xy) : vec4(h.zw, hC.zw + 9.43);\n}\n\nfloat hash21(vec2 p){ return fract(sin(dot(p, vec2(141.173, 289.927)))*43758.5453); }\n\nfloat hex(vec2 p) {\n  vec4 h = getHex(p);\n  return sin(hash21(h.zw)*8. + inFrameTime) * 0.5 + 0.5;\n}\n\n\nvoid main(void) {\n\n  vec3 normal = normalize(vNormal);\n\n  vec3 surfaceToLightDirection = normalize(vPosition - vec3(playerLightPosition.x, -1., playerLightPosition.z));\n  float directional = max(dot(normal, surfaceToLightDirection), 0.0);\n\n  float distanceToPlayer2D = distance(vPosition.xz, playerLightPosition.xz);\n  float spotLight = max(0.3 - vPosition.y, 0.) * max(0., 1. - distanceToPlayer2D * 1.1);\n\n  vec3 light = vColor * (AMBIENT_LIGHT + vec3(mix(1., directional + spotLight, inSurfaceSensitivity)))\n    + vec3(4.5 * spotLight * spotLight * inSurfaceSensitivity);\n\n  if (normal.y > 0.95 && normal.y < 1.05 && vPosition.y  > 0.) {\n    light *= mix(0.6, 0.8, 1.-hex(vPosition.xz*5.));\n  }\n\n  float fog = 1. - smoothstep(0.1, 10., vPosition.y);\n  gl_FragColor = vec4(light * fog, 1.);;\n}\n",n.FRAGMENT_SHADER),n.linkProgram(D),!n.getProgramParameter(D,n.LINK_STATUS))throw Error(n.getProgramInfoLog(D));const B=n.getUniformLocation(D,"Pmatrix"),V=n.getUniformLocation(D,"Vmatrix"),z=n.getAttribLocation(D,"position"),k=n.getAttribLocation(D,"normal"),M=n.getAttribLocation(D,"color"),G=n.getUniformLocation(D,"playerLightPosition"),H=n.getUniformLocation(D,"inTranslation"),O=n.getUniformLocation(D,"inAmbientColor"),Q=n.getUniformLocation(D,"inSurfaceSensitivity"),X=n.getUniformLocation(D,"inFrameTime"),Z=n.getUniformLocation(D,"inFade");this.accumulator=0;const ee=(e,t)=>e.sub(t.mul(1-20*this.accumulator));this.resetCamera=()=>{N=null},this.setCamera=(e,o)=>{const y=ee(e,o),n=[y.x,250,-y.y-100];null===N&&(N=n);const x=q.sub(n,N),r=q.len(x);r>0&&(N=q.add(N,q.mul(q.normalize(x),.001*t.pow(r,2)))),F[0]=-y.x*U,F[2]=y.y*U},this.bg=()=>{o(),n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.clearColor(0,0,0,1),n.clearDepth(1),n.viewport(0,0,h,u),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)};let te=0,oe=0,ie=0,ae=0,le=0;this.timer=e=>{const o=1-e/13,y=t.ceil(13-e);if(ae!==y||e-te>.2){le&&(r.className=""),te=e;let t=new Y(o,1-o);t=t.normalize();const n=A(255*t.y),x=A(255*t.x);if(n!==oe||x!==ie){oe=n,ie=x;const e=A(128*t.x*t.x);r.style.color=`rgb(${n},${x},${e})`}ae!==y&&(ae=y,4>y&&(le=1,r.className="x"),r.innerText=y)}};let ce=1,de=0;const me=(e,t)=>{let o;(!t||0===t.x&&0===t.y)&&(o=e._a),void 0===o&&(o=w(-t.y,t.x),e._a=o);let y=e._r;return e._r=y=((e,t,o)=>{const y=(t-e)%L;return e+(2*y%L-y)*R(o)})(void 0!==y?y:o,o,12*ce),E/2-y};this.player=e=>{const t=ee(e.position,e.movementVector);o(),J(_,-t.x*U,-3.1*U,t.y*U),W(_,me(e,e.drawMovementVector)),n.uniformMatrix4fv(V,0,_),n.uniform3f(O,1,1,1),n.drawElements(n.TRIANGLES,se.player.ibCount,n.UNSIGNED_SHORT,2*se.player.ibStart)},this.ghost=e=>{if(e.dead)return 0;const t=ee(e.position,e.movementVector);return o(),J(_,-t.x*U,-3*U,t.y*U),W(_,me(e,e.movementVector)),n.uniformMatrix4fv(V,0,_),n.drawElements(n.TRIANGLES,se.ghost.ibCount,n.UNSIGNED_SHORT,2*se.ghost.ibStart),1};let pe,he,ue=0,fe=4;const ge=new i;this.level=(e,t,o,y)=>{fe=y,ce=o,e.id!==he&&(he=e.id,pe=0,ge.clear()),ue=R(ue+(4===fe?-ce:ce)),n.enable(n.CULL_FACE),n.cullFace(n.BACK),n.useProgram(D),n.uniform3f(H,0,0,0),n.uniform3f(O,1,1,1),n.uniformMatrix4fv(B,0,P),n.uniformMatrix4fv(V,0,_),n.uniform3fv(G,F),n.uniform1f(X,t),n.uniform1f(Q,ue),n.uniform1f(Z,ue),n.bindBuffer(n.ARRAY_BUFFER,c),n.vertexAttribPointer(z,3,n.FLOAT,0,0,0),n.enableVertexAttribArray(z),n.bindBuffer(n.ARRAY_BUFFER,d),n.vertexAttribPointer(k,3,n.FLOAT,1,0,0),n.enableVertexAttribArray(k),n.bindBuffer(n.ARRAY_BUFFER,m),n.vertexAttribPointer(M,3,n.FLOAT,0,0,0),n.enableVertexAttribArray(M),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,p),n.drawElements(n.TRIANGLES,e.ibCount,n.UNSIGNED_SHORT,2*e.ibStart);for(const t of e.doors)t.open||n.drawElements(n.TRIANGLES,t.ibCount,n.UNSIGNED_SHORT,2*t.ibStart);n.uniform3f(H,-e.start.x*U,U,e.start.y*U),de=ue*R(de+ce*(1===fe?-2:3)),n.uniform1f(Q,de/3),n.uniform3f(O,.2*de,(1-de)/4,.5),n.drawElements(n.TRIANGLES,se.pad.ibCount,n.UNSIGNED_SHORT,2*se.pad.ibStart),n.uniform1f(Q,.4*ue),n.uniform3f(H,-e.end.x*U,3*U,e.end.y*U),pe=C(pe,C(.7,1,1-S(f(1.5*t))),4*ce),n.uniform3f(O,0,pe/1.3,pe);const x=e.last?se.core:se.pad;n.drawElements(n.TRIANGLES,x.ibCount,n.UNSIGNED_SHORT,2*x.ibStart);for(const o of e.switches){const{uid:e,pressed:y}=o;let x=ge.get(e);x||ge.set(e,x={r:1,g:0,p:0});const{r,g:s,p:i}=x;x.r=C(r,y?.1:C(.7,1,1-S(f(3*t))),4*ce),x.g=C(s,y?.3:0,5*ce),x.p=C(x.p,y?3.8*U:0,8*ce),n.uniform1f(Q,ue*s),n.uniform3f(H,-o.x*U,i,o.y*U),n.uniform3f(O,r,s,0),n.drawElements(n.TRIANGLES,se.pad.ibCount,n.UNSIGNED_SHORT,2*se.pad.ibStart)}n.uniform1f(Q,0),n.uniform3f(H,0,0,0)},this.titleScreen=()=>{},this.endScreen=()=>{}}(a.getElementById("c")),le=new function(e){let t,o,y=[],n=0,x=[],s=0,i=0,l=0;const c=a.getElementById("L");let d=-1;const u={},f=()=>{O.death(),l=3};this.draw=(e,x,r)=>{switch(ae.accumulator=e,l){case 0:ae.titleScreen();break;case 1:case 4:case 3:case 2:if(ae.setCamera(o.position,o.movementVector),ae.bg(),ae.level(t.getLevel(),x,r,l),ae.player(o),2==l)for(const e of y)ae.ghost(e);ae.timer(n/20);break;case 5:ae.endScreen()}},this.tick=()=>{if(1===l&&d!==s&&(d=s,c.innerText=t.last?"THE MEMORY CORE":`Level ${s}`,c.className="a",r(()=>{c.className=""},2e3)),1!==l&&4!==l||i>0&&(i-=.05),3===l){let e=new Y(0,0);for(;40>e.len()&&n>0;)e=e.sub(x[--n]);return ae.scale/=.95,o.forceMove(e),void(0===n&&(()=>{for(const e of y)e.reset();y.push(new p(x,t)),y.length>4&&y.shift(),n=0,x=[],t.reset(),o=new m(t),l=1,ae.scale=1.5})())}if(2===l){if(t.completed)return l=4,o.movementVector=new Y(0,0),i=1,void O.win();if(260===n)return void f();x[n]=o.move(u);for(const e of y)e.tick(n);++n}4!==l||i>0||(t.last?a.body.className="started won":(this.loadLevel(s+1),l=1,i=1))},this.buttonDown=e=>{if(0===l)return a.body.className="started",l=1,void(i=1);1!==l||i>0||(l=2),u[e]=1,"back"===e&&f()},this.buttonUp=e=>u[e]=0,this.loadLevel=r=>{s=r,e.length>r||(l=5),t=new h(e[r]),x=[],o=new m(t),y=[],n=0,ae.resetCamera()},this.loadLevel(s)}(I);let ce;le.loadLevel(0);let de=0;const me=e=>{l(me),void 0===ce&&(ce=e);const t=(e-ce)/1e3;(de+=t)>.05&&(de-=.05,le.tick()),de>.05&&(de=.05),le.draw(de,e/1e3,t),ce=e};l(me);const pe={ArrowUp:"up",KeyW:"up",ArrowDown:"down",KeyS:"down",ArrowLeft:"left",KeyA:"left",ArrowRight:"right",KeyD:"right",Backspace:"back"};y.addEventListener("keydown",e=>(pe[e.code]?(le.buttonDown(pe[e.code]),e.preventDefault()):le.buttonDown("*"),0)),y.addEventListener("keyup",e=>(pe[e.code]&&(le.buttonUp(pe[e.code]),e.preventDefault()),0))})(JSON,Math,Array,window,Uint16Array,Audio,setTimeout,Float32Array,Map,document,requestAnimationFrame);</script>


</body></html>